<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Time Tracker</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
</head>
<body>
    {% include 'theme/header.html' %}

    <div class="dashboard-container">
        <div class="welcome-section">
            <h1>
                {% if current_user.user_type == 'company' %}
                    {{ current_user.company_profile.get('company_name', 'User') }}
                {% else %}
                    {{ current_user.individual_profile.get('full_name', 'User') }}
                {% endif %}
            </h1>
            <p>Transform your time tracking data into professional reports</p>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="messages">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <form id="uploadForm" action="{{ url_for('convert') }}" method="POST" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="schema" id="selectedSchema" value="classic">
            
            <!-- Single Step: File Upload + Filters + Preview -->
            <div class="step-section active" id="step1">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <div class="step-info">
                        <h2>Upload & Configure Report</h2>
                        <p>Upload your CSV file, apply filters, and generate your report</p>
                    </div>
                </div>

                <!-- Compact File Upload -->
                <div class="compact-upload">
                    <input type="file" name="csv_file" id="csv_file" accept=".csv" required>
                    <label for="csv_file" class="compact-file-label">
                        <svg width="32" height="32" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        <div class="upload-text">
                            <span class="main-text">Choose CSV File</span>
                            <span class="sub-text">or drag and drop here</span>
                        </div>
                    </label>
                    <div id="fileInfo" class="compact-file-info" style="display: none;">
                        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <span><strong id="fileName"></strong> â€¢ <span id="rowCount"></span> rows</span>
                    </div>
                </div>

                <!-- Filters + Live Preview -->
                <div class="filters-preview-container">
                    <!-- Left: Filters -->
                    <div class="filters-panel">
                        <h3>
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
                            </svg>
                            Filters
                        </h3>

                        <div class="filter-group">
                            <label>
                                <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                                </svg>
                                Columns
                            </label>
                            <div id="columnSelector" class="checkbox-group"></div>
                        </div>

                        <div class="filter-group">
                            <label for="projectSelect">
                                <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2"/>
                                </svg>
                                Projects
                            </label>
                            <select name="projectSelect[]" id="projectSelect" multiple size="4">
                                <option value="" selected>All Projects</option>
                            </select>
                        </div>

                        <div class="filter-group">
                            <label for="clientSelect">
                                <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857"/>
                                </svg>
                                Clients
                            </label>
                            <select name="clientSelect[]" id="clientSelect" multiple size="4">
                                <option value="" selected>All Clients</option>
                            </select>
                        </div>

                        <div class="filter-group">
                            <label for="userSelect">
                                <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                </svg>
                                Users
                            </label>
                            <select name="userSelect[]" id="userSelect" multiple size="4">
                                <option value="" selected>All Users</option>
                            </select>
                        </div>

                        <div class="filter-group">
                            <label for="formatSelect">
                                <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                Format
                            </label>
                            <select name="formatSelect" id="formatSelect">
                                <option value="decimal">Decimal (8.50)</option>
                                <option value="hours">Time (8:30)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Right: Live Preview -->
                    <div class="preview-panel">
                        <h3>
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                <path d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                            </svg>
                            Live Preview
                        </h3>
                        <div id="dataPreview" class="data-preview">
                            <div class="preview-placeholder">
                                <svg width="64" height="64" fill="none" stroke="currentColor" stroke-width="1">
                                    <path d="M9 12h6m-6 4h6m-6 4h6m9-10h6m-6 4h6m-6 4h6M9 5a2 2 0 00-2 2v10a2 2 0 002 2h14a2 2 0 002-2V7a2 2 0 00-2-2H9z"/>
                                </svg>
                                <p>Upload a CSV file to see preview</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="step-actions">
                    <button type="submit" class="btn-success">
                        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                        </svg>
                        Generate Report
                    </button>
                </div>
            </div>
        </form>
    </div>

    {% include 'theme/footer.html' %}

    <script src="{{ url_for('static', filename='dashboard.js') }}"></script>
</body>
</html>